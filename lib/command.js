#!/usr/bin/env node
"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var SwaggerParameterInEnum,SchemaTypeEnum,genListEnum,JsonTypeEnum,swagger=_interopDefault(require("swagger-client")),__assign=function(){return(__assign=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++)for(var a in r=arguments[t])Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a]);return e}).apply(this,arguments)};function __awaiter(e,o,i,u){return new(i=i||Promise)(function(t,r){function n(e){try{s(u.next(e))}catch(e){r(e)}}function a(e){try{s(u.throw(e))}catch(e){r(e)}}function s(e){var r;e.done?t(e.value):((r=e.value)instanceof i?r:new i(function(e){e(r)})).then(n,a)}s((u=u.apply(e,o||[])).next())})}function __generator(n,a){var s,o,i,u={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},e={next:r(0),throw:r(1),return:r(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function r(t){return function(e){var r=[t,e];if(s)throw new TypeError("Generator is already executing.");for(;u;)try{if(s=1,o&&(i=2&r[0]?o.return:r[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,r[1])).done)return i;switch(o=0,(r=i?[2&r[0],i.value]:r)[0]){case 0:case 1:i=r;break;case 4:return u.label++,{value:r[1],done:!1};case 5:u.label++,o=r[1],r=[0];continue;case 7:r=u.ops.pop(),u.trys.pop();continue;default:if(!(i=0<(i=u.trys).length&&i[i.length-1])&&(6===r[0]||2===r[0])){u=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){u.label=r[1];break}if(6===r[0]&&u.label<i[1]){u.label=i[1],i=r;break}if(i&&u.label<i[2]){u.label=i[2],u.ops.push(r);break}i[2]&&u.ops.pop(),u.trys.pop();continue}r=a.call(n,u)}catch(e){r=[6,e],o=0}finally{s=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}}}!function(e){e[e.path=0]="path",e[e.query=1]="query",e[e.body=2]="body",e[e.formData=3]="formData",e[e.header=4]="header"}(SwaggerParameterInEnum=SwaggerParameterInEnum||{}),function(e){e[e.string=0]="string",e[e.number=1]="number",e[e.integer=2]="integer",e[e.boolean=3]="boolean",e[e.object=4]="object",e[e.array=5]="array",e[e.null=6]="null",e[e.any=7]="any"}(SchemaTypeEnum=SchemaTypeEnum||{}),function(e){e[e.api=0]="api",e[e.ts=1]="ts",e[e.service=2]="service"}(genListEnum=genListEnum||{}),function(e){e[e.json=0]="json",e[e.jsonSchema=1]="jsonSchema"}(JsonTypeEnum=JsonTypeEnum||{});var getResponseList=function(e){for(var r=[],t=0,n=Object.entries(e.responses);t<n.length;t++){var a=n[t],s=a[0],a=a[1];r.push(__assign({statusCode:s,type:a.type,description:a.description},a.schema||{}))}return r},getRequestInfo=function(t){var n,a=[],s=[],o=[],e="json";return Array.isArray(t.consumes)&&(a.push({name:"Content-Type",required:!0,value:t.consumes[0]}),t.consumes.includes("application/x-www-form-urlencoded")||t.consumes.includes("multipart/form-data")?e="form":t.consumes.includes("application/json")&&(e="json")),Array.isArray(t.parameters)&&t.parameters.forEach(function(e){var r={name:(e="object"===e&&e.$ref?function(e,r){if(!e||"string"!=typeof e||0!==e.indexOf("#/")||e.length<=2)return null;var t=e.substr(2).split("/");t=t.filter(function(e){return e});for(var n=0,a=t.length;n<a;n++)try{r=r[t[n]]}catch(e){r="";break}return r}(e.$ref,{parameters:t.parameters}):e).name,required:e.required||!1,description:e.description};switch(e.in){case"path":s.push(r);break;case"query":o.push(r);break;case"body":n=__assign({name:e.name,required:e.required,description:e.description},e.schema||{});break;case"formData":r.type=e.type||"text",(n=Array.isArray(n)?n:[]).push(r);break;case"header":a.push(r)}}),{requestHeader:a,requestPathParam:s,requestPathQuery:o,requestBody:n,requestBodyType:e}},parseSwagger=function(y){return __awaiter(void 0,void 0,Promise,function(){var r,t,n,a,s,o,i,u,c,p,f,l,g,h,d;return __generator(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,swagger({spec:y})];case 1:for(d=e.sent(),y=d.spec,r=[],t=0,n=Object.entries(y.paths);t<n.length;t++)for(s=n[t],a=s[0],s=s[1],o=0,i=Object.entries(s);o<i.length;o++)c=i[o],u=c[0],c=c[1],h=getRequestInfo(c),p=h.requestHeader,f=h.requestPathParam,l=h.requestPathQuery,g=h.requestBody,h=h.requestBodyType,r.push({path:a,method:u,tags:c.tags,summary:c.summary,description:c.description,requestHeader:p,requestBodyType:h,requestPathParam:f,requestPathQuery:l,requestBody:g,responseList:getResponseList(c)});return[2,{swagger:y.swagger,info:y.info||{},basePath:y.basePath||"",tags:y.tags||[],apiList:r,paths:y.paths,definitions:y.definitions}];case 2:return d=e.sent(),console.error(d),[2,{swagger:y.swagger,info:y.info,basePath:y.basePath,tags:y.tags,apiList:[],paths:y.paths,definitions:y.definitions}];case 3:return[2]}})})},genTS=function(e,r){return console.log("---genService",e,r),""},genService=function(e,r){return console.log("---genService",e,r),""},swaggerGenCode=function(a,s,o){return void 0===s&&(s=[]),void 0===o&&(o={}),__awaiter(void 0,void 0,Promise,function(){var r,t,n;return __generator(this,function(e){switch(e.label){case 0:return[4,parseSwagger(a)];case 1:return n=e.sent(),s.includes(genListEnum.ts)&&(r=genTS(n,o)),s.includes(genListEnum.service)&&(t=genService(n,o)),n={apiInfo:n},[2,Object.assign(n,r?{ts:r}:{},t?{service:t}:{})]}})})};exports.swaggerGenCode=swaggerGenCode;
//# sourceMappingURL=command.js.map
